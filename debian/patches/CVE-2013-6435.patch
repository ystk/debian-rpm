Description: Create the file with mode 0
 It was found that RPM wrote file contents to the target installation
 directory under a temporary name, and verified its cryptographic
 signature only after the temporary file has been written
 completely. Under certain conditions, the system interprets the
 unverified temporary file contents and extracts commands from
 it. This could allow an attacker to modify signed RPM files in such a
 way that they would execute code chosen by the attacker during
 package installation.
Origin: https://bugzilla.redhat.com/attachment.cgi?id=956268&action=diff
Bug: https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2013-6435
Last-Update: 2014-12-14

Index: rpm-4.11.3/lib/fsm.c
===================================================================
--- rpm-4.11.3.orig/lib/fsm.c	2014-12-14 18:01:29.484568052 -0800
+++ rpm-4.11.3/lib/fsm.c	2014-12-14 18:02:05.550228685 -0800
@@ -731,7 +731,12 @@
     pgpHashAlgo digestalgo = 0;
     int rc = 0;
 
-    wfd = Fopen(fsm->path, "w.ufdio");
+    /* Create the file with 000 permissions. */
+    {
+	mode_t old_umask = umask(0777);
+	wfd = Fopen(fsm->path, "w.ufdio");
+	umask(old_umask);
+    }
     if (Ferror(wfd)) {
 	rc = CPIOERR_OPEN_FAILED;
 	goto exit;
